<% blogList.forEach(blog => { %>
<div class="item-wrapper" style="display: flex; align-items: center;margin: 20px 0;">
  <img class="user-picture" src="<%= blog.user.picture %>" alt="" style="width: 60px; height: 60px; border-radius: 50%;">
  <div class="content-wrapper" style="margin-left: 20px;">
    <div class="content clear-fix">
      <% if(blog.image) { %>
      <a href="<%= blog.image %>" target="_blank">
        <img src="<%= blog.image %>" alt="" style="position: absolute; top: 0; right: 0; width: 100px; height: 100px;">
      </a>
      <% } %>
      <a href="/profile/<%= blog.user.userName %>">
        <%= blog.user.nickName %>
      </a>:
      <!-- <span><%= blog.content %></span> -->
      <!-- html使用 - 来渲染 -->
      <span class="wb-content"><%- blog.formatContent %></span>
    </div>

    <div class="info">
      <span><%= blog.createdAtFormat %></span>
      &nbsp;
      <% if(locals.canReply) { %>
        <a href="#" class="blog-list-reply" data-content="<%= blog.content %>" data-userName="<%= blog.user.userName %>"
          data-nickName="<%= blog.user.nickName %>">
          <i class="fa fa-mail-reply">回复</i>
        </a>
      <% } %>
    </div>
  </div>
</div>
<% }) %>

<script>
  $(function () {
    // 设置焦点
    function setCursor(el, st, end) {
      if (el.setSelectionRange) {
        console.log('setSelectionRange')
        el.focus()
        el.setSelectionRange(st, end)
      } else if(el.createTextRange) {
        // ie兼容
        var range = el.createTextRange()
        range.collapse(true)
        range.moveEnd('charater', end)
        range.moveStart('charater', st)
        range.select()
      }
    }

    // 回复
    var $textContent = $('#text-content')
    $('.blog-list-reply').click(function(e) {
      e.preventDefault()
      e.stopPropagation()
      var $target = $(e.currentTarget)
      // 获取内容和用户
      var content = $target.attr('data-content')
      var userName = $target.attr('data-userName')
      var nickName = $target.attr('data-nickName')
      // 设置内容并获取焦点
      $textContent.val(' // @' + nickName + ' - ' + userName + ' : ' + content)
      setCursor($textContent[0], 0, 0)
    })
  })
</script>